# 性能

## 前言

网页的优化，根据在浏览器输入一个地址访问网页的原理，对整条链路进行拆分。可以初步拆分为：
1. 网络请求优化
2. 浏览器渲染优化
3. 浏览器js执行优化

## 网络请求优化

网络请求优化又可以细分为：
1. 网络优化
2. 资源、数据加载优化
3. 缓存
4. 服务器响应优化

### 网络优化

网络优化主要是从路由和DNS还有请求协议等多方面偏网络本身进行优化。这主要是运维的工作，但是需要了解

### DNS优化

当通过域名来访问页面的时候，浏览器发起页面请求时，是需要通过DNS解析，来寻找服务器所在的真实网络IP地址。

可以通过 dig +trace 命令来看整个过程 

1. 浏览器先读取自己最近访问、访问频繁的 `域名-IP` 缓存
2. 从本机hosts配置中读取是否已经有静态配置好的 `域名-IP` 配置
3. 通过本机配置的DNS服务器，一般在电脑的网络适配器配置，通过DNS服务器查找`域名-IP`
4. 没有本机配置的DNS服务器的话，会去网络运营商的DNS服务器中查找`域名-IP`
5. 从一级域名下，找二级域名，再三级。。。直到找到为止

![](./images/dns.jpg)

ps:具体信息解读 自己百度dig命令

这个过程中，1和2比较难控制，毕竟是用户本身本地环境，无法通过人工进行干涉。3～5，都可以进行一定的干涉。

### 资源加载的优化

网页请求过程中，会有很多数据和资源需要加载。其中静态资源的请求过程，如html、css、js、图片等等，都可以进行一定程度的优化。

其实主要有2个方面 减少请求次数和减小请求大小，但这者是互斥的。

#### 减少请求次数

因为浏览器对网页的并发请求数目都会有一定限制，不考虑资源大小来说，资源个数越多，即页面加载的内容越多，页面加载的速度就越慢，因此就需要减少请求次数。

常见的优化方案有：

1. 对资源进行合并，如js的bundle、css的合并，雪碧图等
2. 静态资源数据化，如icon图等较小资源转base64加载等
3. 按需加载，如按需加载js、图片等资源的懒加载等

#### 减小请求大小

当请求次数固定下来无法减少后，对请求、请求返回内容的大小也是影响整个网页加载的重要因素。

其次，如果一味的强调减少请求次数，出现例如资源合并，结果合并的单个资源文件很大，而不加载完这个文件，其他操作都没法继续下去，这种场景，一味的减少请求个数就很鸡肋，拆分多个请求包后充分利用并发加载资源能够反而更好。

常见的优化方案有： 
1. 服务器级的整体压缩，如gzip 
2. 对资源本身进行压缩，如图片压缩、js css压缩 
3. 去除无用代码，如tree shaking
4. 按需加载，而不是直接引入一个完整包然后使用其中极少的某一部分 
5. 接口数据，去除无用的数据

### 缓存

至于缓存指点请查看之前的文章

### 服务器响应优化

当请求到服务器时，快速响应。



